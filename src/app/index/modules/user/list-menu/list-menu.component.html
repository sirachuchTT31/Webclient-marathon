<div class="wrapper-list-menu">
  <div class="box-search-list-menu pt-3">
    <div class="box-input-search">
      <form [formGroup]="search_Form">
        <div class="form-group  pt-2 position-relative">
          <input type="text" class="form-control" (keyup)="searchBox($event)" [matAutocomplete]="auto" matInput
            placeholder="ค้นหาด้วยชื่องาน | ค้นด้วยจังหวัดงาน | ค้นหาด้วยสถานที่งาน" formControlName="char_search">
          <app-remove-icon *ngIf="this.search_Form.controls['char_search'].value?.length > 0"
            (click)="removersearchBox()"></app-remove-icon>
          <mat-autocomplete #auto="matAutocomplete">
            <mat-option
              *ngFor="let option of this.register_running_event_array | filter : this.search_Form.controls['char_search']?.value "
              [value]="option.name" (click)="onClickfilter(option.id)">
              <span>{{option.name}} | {{option.MasterLocation.province}} | {{option.MasterLocation.district}} <img
                  [src]="option.path_image" class="img-box-search"></span>
            </mat-option>
          </mat-autocomplete>
        </div>
      </form>
    </div>
    <div class="box-button-search pt-2">
      <button type="button" class="btn btn-primary " (click)="onSearch()"><svg xmlns="http://www.w3.org/2000/svg"
          width="30" height="25" viewBox="0 0 400 400" fill="none">
          <path d="M244.17 254.01L340.17 350" stroke="#fff" stroke-width="12" stroke-miterlimit="10"
            stroke-linecap="round" stroke-linejoin="round" />
          <path
            d="M173.93 278.2C236.946 278.2 288.03 227.116 288.03 164.1C288.03 101.084 236.946 50 173.93 50C110.914 50 59.8301 101.084 59.8301 164.1C59.8301 227.116 110.914 278.2 173.93 278.2Z"
            stroke="#fff" stroke-width="12" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M137.51 77.87C148.69 73.1 161 70.47 173.93 70.47C189.7 70.47 204.55 74.4 217.57 81.33" stroke="#fff"
            stroke-width="12" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round" />
        </svg></button>
    </div>
  </div>
  <div class="box-wrap-refresh">
    <button class="btn refresh-button" (click)="onRefresh()">
      <svg xmlns="http://www.w3.org/2000/svg" height="25" width="25" fill="#fff"
        viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
        <path
          d="M370.7 133.3C339.5 104 298.9 88 255.8 88c-77.5 .1-144.3 53.2-162.8 126.9-1.3 5.4-6.1 9.2-11.7 9.2H24.1c-7.5 0-13.2-6.8-11.8-14.2C33.9 94.9 134.8 8 256 8c66.4 0 126.8 26.1 171.3 68.7L463 41C478.1 25.9 504 36.6 504 57.9V192c0 13.3-10.7 24-24 24H345.9c-21.4 0-32.1-25.9-17-41l41.8-41.7zM32 296h134.1c21.4 0 32.1 25.9 17 41l-41.8 41.8c31.3 29.3 71.8 45.3 114.9 45.3 77.4-.1 144.3-53.1 162.8-126.8 1.3-5.4 6.1-9.2 11.7-9.2h57.3c7.5 0 13.2 6.8 11.8 14.2C478.1 417.1 377.2 504 256 504c-66.4 0-126.8-26.1-171.3-68.7L49 471C33.9 486.1 8 475.4 8 454.1V320c0-13.3 10.7-24 24-24z" />
      </svg>
    </button>
  </div>
  <div class="box-no-data mt-5" *ngIf="!list_show_register">
    <h4>ไม่พบข้อมูล (No data)</h4>
  </div>
  <div class="box-content-list-menu">
    <div class="card card-list"
      *ngFor="let rs of list_show_register | paginate: { itemsPerPage: config.pageSize, currentPage: config.currentPage ,  totalItems : config.totalRecord}index as i;">
      <img [src]="rs.path_image" style="width: 100%; height: 200px;" class="card-img-top" alt="...">
      <div class="card-body">
        <h5 class="card-title-event ">{{rs.name}}</h5>
        <p><span class="me-2">วันที่จัดงาน</span><span class="me-2">:</span> <span>{{rs.due_date | date :
            'yyyy-MM-dd'}}</span></p>
        <p class="card-text-event ">{{rs.detail}}</p>

        <p class="card-text-event-price mb-0" *ngIf="rs.max_amount >0">฿ {{formatNumber(rs.price)}}</p>
        <p class="card-text-event-amount mb-1" *ngIf="rs.max_amount >0">จำนวนคงเหลือ {{formatNumber(rs.max_amount)}}</p>
        <div class="box-sold-out h-auto" *ngIf="rs.max_amount === 0">
          <span class="card-text-event-amount text-danger text-center">Sold out</span>
        </div>
        <div class="text-center" *ngIf="rs.max_amount > 0">
          <a class="btn btn-primary " (click)="openModal(modalcreate,rs)">ลงทะเบียนวิ่ง</a>
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-center  mt-5" *ngIf="config.totalRecord > 0">
    <pagination-controls (pageChange)="changePage($event)"></pagination-controls>
  </div>
</div>


<!-- FIXBUG -->
<ng-template #modalcreate let-modal>
  <div class="modal-header justify-content-center">
    <h4 class="modal-title ">ลงทะเบียนวิ่ง (Register running)</h4>
  </div>
  <div class="modal-body">
    <form [formGroup]="create_register_running_Form" class="m-0 p-0">
      <div class="form-group">
        <div class="box-input-group">
          <label>ชื่องาน</label>
          <input type="text" class="form-control" placeholder="ชื่องาน" formControlName="reg_event_name" maxlength="40"
            [ngClass]="{
              required:
              create_register_running_Form.controls['reg_event_name'].invalid &&
              create_register_running_Form.controls['reg_event_name'].touched
              }">
          <span *ngIf="
                  create_register_running_Form.controls['reg_event_name'].invalid &&
                  create_register_running_Form.controls['reg_event_name'].touched">
            <span *ngIf="
                      create_register_running_Form.controls['reg_event_name'].errors">
              <small class="text-danger">
                กรุณาระบุชื่องาน
              </small>
            </span>
          </span>
        </div>
        <div class="box-input-group">
          <label>ชื่อผู้ลงทะเบียน</label>
          <input type="text" class="form-control" placeholder="ชื่อผู้ลงทะเบียน" formControlName="name" maxlength="40"
            [ngClass]="{
              required:
              create_register_running_Form.controls['name'].invalid &&
              create_register_running_Form.controls['name'].touched
              }">
          <span *ngIf="
                  create_register_running_Form.controls['name'].invalid &&
                  create_register_running_Form.controls['name'].touched">
            <span *ngIf="
                      create_register_running_Form.controls['name'].errors">
              <small class="text-danger">
                กรุณาระบุชื่องาน
              </small>
            </span>
          </span>
        </div>
        <div class="box-input-group">
          <label>นามสกุลผู้ลงทะเบียน</label>
          <input type="text" class="form-control" placeholder="นามสกุลผู้ลงทะเบียน" formControlName="lastname"
            maxlength="40" [ngClass]="{
              required:
              create_register_running_Form.controls['lastname'].invalid &&
              create_register_running_Form.controls['lastname'].touched
              }">
          <span *ngIf="
                  create_register_running_Form.controls['lastname'].invalid &&
                  create_register_running_Form.controls['lastname'].touched">
            <span *ngIf="
                      create_register_running_Form.controls['lastname'].errors">
              <small class="text-danger">
                กรุณาระบุชื่องาน
              </small>
            </span>
          </span>
        </div>
        <div class="box-input-group">
          <label>รายละเอียด</label>
          <textarea type="text" class="form-control" placeholder="รายละเอียด" formControlName="dsc" maxlength="80"
            [ngClass]="{
              required:
              create_register_running_Form.controls['dsc'].invalid &&
              create_register_running_Form.controls['dsc'].touched
              }">
              </textarea>
          <span *ngIf="
                  create_register_running_Form.controls['dsc'].invalid &&
                  create_register_running_Form.controls['dsc'].touched">
            <span *ngIf="
                      create_register_running_Form.controls['dsc'].errors">
              <small class="text-danger">
                กรุณาระบุรายละเอียด
              </small>
            </span>
            ? </span>
        </div>
        <div class="d-flex justify-content-center mb-3 mt-3">
          <button class="btn btn-primary btn-modal-submit me-3" (change)="checkcreateModal()"
            [disabled]="checkcreateModal() === false" (click)="saveData();modal.dismiss()">บันทึกข้อมูล</button>
          <button class="btn btn-danger btn-modal-submit" (click)="modal.dismiss()">ยกเลิก</button>
        </div>
      </div>
    </form>
  </div>
</ng-template>